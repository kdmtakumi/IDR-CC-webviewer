{% extends "layout.html" %}

{% block title %}Supramolecular{% endblock %}

{% block content %}
<section class="panel">
  <h1>Supramolecular interactions</h1>
  <p>Filter PPI pairs from BioGRID (multi-validated) and STRING (combined_score &gt; 700). IDR/CC thresholds apply to両方のパートナー。</p>
  <form method="get" class="filters">
    <div class="form-row">
      <label for="source">Source</label>
      <select name="source" id="source">
        <option value="" {% if not source %}selected{% endif %}>All</option>
        <option value="biogrid" {% if source == "biogrid" %}selected{% endif %}>BioGRID (multi-validated)</option>
        <option value="string" {% if source == "string" %}selected{% endif %}>STRING (&gt;700)</option>
      </select>

      <label for="uniprot">UniProt ID</label>
      <input type="text" id="uniprot" name="uniprot" value="{{ uniprot_id or '' }}" placeholder="e.g. O15083" />

      <label for="score_min">Min STRING score</label>
      <input type="number" id="score_min" name="score_min" value="{{ min_score if min_score is not none else '' }}" min="0" step="1" />
    </div>
    <div class="form-row">
      <label for="idr_pct_min">Min IDR %</label>
      <input type="number" id="idr_pct_min" name="idr_pct_min" value="{{ min_idr_pct if min_idr_pct is not none else '' }}" min="0" max="100" step="0.1" />

      <label for="cc_pct_min">Min CC %</label>
      <input type="number" id="cc_pct_min" name="cc_pct_min" value="{{ min_cc_pct if min_cc_pct is not none else '' }}" min="0" max="100" step="0.1" />

      <label for="per_page">Per page</label>
      <select name="per_page" id="per_page">
        {% for option in [10,25,50,100] %}
        <option value="{{ option }}" {% if per_page == option %}selected{% endif %}>{{ option }}</option>
        {% endfor %}
      </select>

      <button type="submit">Filter</button>
    </div>
  </form>

  <p class="meta">Found {{ total_items }} pairs. Showing {{ start_item }}–{{ end_item }}.</p>

  <table class="data">
    <thead>
      <tr>
        <th>Source</th>
        <th>UniProt A</th>
        <th>Gene A</th>
        <th>IDR% A</th>
        <th>CC% A</th>
        <th>UniProt B</th>
        <th>Gene B</th>
        <th>IDR% B</th>
        <th>CC% B</th>
        <th>Score</th>
      </tr>
    </thead>
    <tbody>
      {% if records %}
        {% for r in records %}
        <tr>
          <td>{{ r.source }}</td>
          <td><a href="{{ url_for('protein_detail', uniprot_id=r.a_id, return_to=request.full_path) }}">{{ r.a_id }}</a></td>
          <td>{{ r.a_gene }}</td>
          <td>{{ "%.2f"|format(r.a_idr_pct) if r.a_idr_pct is not none else "" }}</td>
          <td>{{ "%.2f"|format(r.a_cc_pct) if r.a_cc_pct is not none else "" }}</td>
          <td><a href="{{ url_for('protein_detail', uniprot_id=r.b_id, return_to=request.full_path) }}">{{ r.b_id }}</a></td>
          <td>{{ r.b_gene }}</td>
          <td>{{ "%.2f"|format(r.b_idr_pct) if r.b_idr_pct is not none else "" }}</td>
          <td>{{ "%.2f"|format(r.b_cc_pct) if r.b_cc_pct is not none else "" }}</td>
          <td>{{ r.combined_score if r.combined_score is not none else "" }}</td>
        </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="10">No pairs found for the current filters.</td></tr>
      {% endif %}
    </tbody>
  </table>

  {% if total_pages > 1 %}
  <div class="pagination">
    {% if show_first %}<a href="{{ page_url(1) }}">1</a>{% endif %}
    {% for num in page_numbers %}
      {% if num == page %}
        <span class="current">{{ num }}</span>
      {% else %}
        <a href="{{ page_url(num) }}">{{ num }}</a>
      {% endif %}
    {% endfor %}
    {% if show_last %}<a href="{{ page_url(total_pages) }}">{{ total_pages }}</a>{% endif %}
  </div>
  {% endif %}
</section>
{% endblock %}
